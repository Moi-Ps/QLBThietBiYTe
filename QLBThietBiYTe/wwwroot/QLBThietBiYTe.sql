-- Tạo cơ sở dữ liệu
CREATE DATABASE QLBThietBiYTe;
GO

-- Sử dụng cơ sở dữ liệu
USE QLBThietBiYTe;
SET DATEFORMAT DMY;
GO

-- Tạo bảng CHITIETHOADON
CREATE TABLE CHITIETHOADON (
    ID INT IDENTITY(1,1),
    MACHITIET NVARCHAR(10) PRIMARY KEY,
    MAHOADON NVARCHAR(10) NOT NULL,
    MATHIETBI NVARCHAR(10) NOT NULL,
    SOLUONG INT CHECK (SOLUONG >= 0),
    GIATIEN INT CHECK (GIATIEN >= 0),
    THANHTIEN AS (SOLUONG * GIATIEN) PERSISTED
);
GO

-- Tạo bảng HOADON
CREATE TABLE HOADON (
    ID INT IDENTITY(1,1),
    MAHOADON NVARCHAR(10) PRIMARY KEY,
    TENKHACHHANG NVARCHAR(50),
    NGAYLAP DATETIME,
    TONGTIEN DECIMAL(10, 2)
);
GO

-- Tạo bảng KHO
CREATE TABLE KHO (
    ID INT IDENTITY(1,1),
    MAKHO NVARCHAR(10) PRIMARY KEY,
    MATHIETBI NVARCHAR(10) NOT NULL,
    SOLUONG INT CHECK (SOLUONG >= 0)
);
GO

-- Tạo bảng LOAITHIETBI
CREATE TABLE LOAITHIETBI (
    ID INT IDENTITY(1,1),
    MALOAI NVARCHAR(10) PRIMARY KEY,
    TENLOAITHIETBI NVARCHAR(50) NOT NULL
);
GO

-- Tạo bảng NHACUNGCAP
CREATE TABLE NHACUNGCAP (
    ID INT IDENTITY(1,1),
    MANCC NVARCHAR(10) PRIMARY KEY,
    TENNHACUNGCAP NVARCHAR(50) NOT NULL
);
GO

-- Tạo bảng THIETBI
CREATE TABLE THIETBI (
    ID INT IDENTITY(1,1),
    MATHIETBI NVARCHAR(10) PRIMARY KEY,
    TENTHIETBI NVARCHAR(100),
    MALOAI NVARCHAR(10) NOT NULL,
    GIAMUA INT CHECK (GIAMUA >= 0),
    GIABAN INT CHECK (GIABAN >= 0),
    MANCC NVARCHAR(10) NOT NULL,
    NAMSANXUAT DATE
);
GO

-- Tạo bảng TAIKHOAN
CREATE TABLE TAIKHOAN (
    ID INT IDENTITY(1,1),
    MATAIKHOAN NVARCHAR(10) PRIMARY KEY,
    USERNAME NVARCHAR(20) NOT NULL,
    PASS_WORD NVARCHAR(100),
    ROLE NVARCHAR(10) DEFAULT 'Admin'
);
GO

-- Thêm ràng buộc khóa ngoại
ALTER TABLE CHITIETHOADON
    ADD CONSTRAINT FK_CHITIETHOADON_HOADON FOREIGN KEY (MAHOADON) REFERENCES HOADON (MAHOADON);

ALTER TABLE CHITIETHOADON
    ADD CONSTRAINT FK_CHITIETHOADON_THIETBI FOREIGN KEY (MATHIETBI) REFERENCES THIETBI (MATHIETBI);

ALTER TABLE KHO
    ADD CONSTRAINT FK_KHO_THIETBI FOREIGN KEY (MATHIETBI) REFERENCES THIETBI (MATHIETBI);

ALTER TABLE THIETBI
    ADD CONSTRAINT FK_THIETBI_LOAITHIETBI FOREIGN KEY (MALOAI) REFERENCES LOAITHIETBI (MALOAI);

ALTER TABLE THIETBI
    ADD CONSTRAINT FK_THIETBI_NHACUNGCAP FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP (MANCC);
GO


-- Thêm dữ liệu bảng LOAITHIETBI
INSERT INTO LOAITHIETBI (MALOAI, TENLOAITHIETBI)
VALUES 
('L001', N'Máy đo huyết áp'),
('L002', N'Máy xông mũi họng'),
('L003', N'Nhiệt kế điện tử');

-- Thêm dữ liệu bảng NHACUNGCAP
INSERT INTO NHACUNGCAP (MANCC, TENNHACUNGCAP)
VALUES 
('NCC01', N'Công ty Thiết bị Y tế A'),
('NCC02', N'Công ty Y tế B'),
('NCC03', N'Công ty Dược phẩm C');

-- Thêm dữ liệu bảng THIETBI
INSERT INTO THIETBI (MATHIETBI, TENTHIETBI, MALOAI, GIAMUA, GIABAN, MANCC, NAMSANXUAT)
VALUES
('TB001', N'Máy đo huyết áp Omron', 'L001', 800000, 1200000, 'NCC01', '01/01/2023'),
('TB002', N'Máy xông Omron NE-C28', 'L002', 500000, 750000, 'NCC02', '15/06/2022'),
('TB003', N'Nhiệt kế Microlife', 'L003', 150000, 250000, 'NCC03', '10/12/2023');

-- Thêm dữ liệu bảng KHO
INSERT INTO KHO (MAKHO, MATHIETBI, SOLUONG)
VALUES
('K001', 'TB001', 50),
('K002', 'TB002', 30),
('K003', 'TB003', 100);

-- Thêm dữ liệu bảng HOADON
INSERT INTO HOADON (MAHOADON, TENKHACHHANG, NGAYLAP, TONGTIEN)
VALUES
('HD001', N'Bệnh viện Đa khoa X', '20/05/2024', 2400000),
('HD002', N'Phòng khám Tư nhân Y', '21/05/2024', 1500000);

-- Thêm dữ liệu bảng CHITIETHOADON
INSERT INTO CHITIETHOADON (MACHITIET, MAHOADON, MATHIETBI, SOLUONG, GIATIEN)
VALUES
('CT001', 'HD001', 'TB001', 2, 1200000),
('CT002', 'HD001', 'TB003', 4, 250000),
('CT003', 'HD002', 'TB002', 2, 750000);

-- Thêm dữ liệu bảng TAIKHOAN
INSERT INTO TAIKHOAN (MATAIKHOAN, USERNAME, PASS_WORD, ROLE)
VALUES
('TK001', 'admin1', 'abc@123', 'Admin'),
('TK002', 'nhanvien1', '123456', 'Staff');
